function LAppLive2DManager(t){this.models=[],this.reloadFlg=!1,Live2D.init(),Live2DFramework.setPlatformManager(new PlatformManager(t))}function LAppModel(){L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[],this.dragMgr=null,this.audioElement=null,this.audioContext=null,this.audioAnalyser=null,this.bufferSource=null,this.intervalId=null}function L2DBaseModel(){this.live2DModel=null,this.modelMatrix=null,this.eyeBlink=null,this.physics=null,this.pose=null,this.debugMode=!1,this.initialized=!1,this.updating=!1,this.alpha=1,this.accAlpha=0,this.lipSync=!1,this.lipSyncValue=0,this.accelX=0,this.accelY=0,this.accelZ=0,this.dragX=0,this.dragY=0,this.startTimeMSec=null,this.mainMotionManager=new L2DMotionManager,this.expressionManager=new L2DMotionManager,this.motions={},this.expressions={},this.isTexLoaded=!1}function L2DExpressionMotion(){AMotion.prototype.constructor.call(this),this.paramList=new Array}function L2DExpressionParam(){this.id="",this.type=-1,this.value=null}function L2DEyeBlink(){this.nextBlinkTime=null,this.stateStartTime=null,this.blinkIntervalMsec=null,this.eyeState=EYE_STATE.STATE_FIRST,this.blinkIntervalMsec=4e3,this.closingMotionMsec=100,this.closedMotionMsec=50,this.openingMotionMsec=150,this.closeIfZero=!0,this.eyeID_L="PARAM_EYE_L_OPEN",this.eyeID_R="PARAM_EYE_R_OPEN"}function L2DMatrix44(){this.tr=new Float32Array(16),this.identity()}function L2DModelMatrix(t,e){L2DMatrix44.prototype.constructor.call(this),this.width=t,this.height=e}function L2DMotionManager(){MotionQueueManager.prototype.constructor.call(this),this.currentPriority=null,this.reservePriority=null,this.super=MotionQueueManager.prototype}function L2DPhysics(){this.physicsList=new Array,this.startTimeMSec=UtSystem.getUserTimeMSec()}function L2DPose(){this.lastTime=0,this.lastModel=null,this.partsGroups=new Array}function L2DPartsParam(t){this.paramIndex=-1,this.partsIndex=-1,this.link=null,this.id=t}function L2DTargetPoint(){this.EPSILON=.01,this.faceTargetX=0,this.faceTargetY=0,this.faceX=0,this.faceY=0,this.faceVX=0,this.faceVY=0,this.lastTimeSec=0}function L2DViewMatrix(){L2DMatrix44.prototype.constructor.call(this),this.screenLeft=null,this.screenRight=null,this.screenTop=null,this.screenBottom=null,this.maxLeft=null,this.maxRight=null,this.maxTop=null,this.maxBottom=null,this.max=Number.MAX_VALUE,this.min=0}function Live2DFramework(){}function Live2DHelper(t){var e={canvas:""};Object.assign(e,t),this.platform=window.navigator.platform.toLowerCase(),this.gl=null,this.canvas=document.getElementById(e.canvas),null==this.canvas&&console.log("live2d error: the canvas is undefined"),this.live2DMgr=new LAppLive2DManager(this.canvas),this.isDrawStart=!1,this.dragMgr=null,this.viewMatrix=null,this.projMatrix=null,this.deviceToScreen=null,this.oldLen=0,this.lastMouseX=0,this.lastMouseY=0,this.pModel=0,this.init()}function getWebGLContext(t){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=0;i<e.length;i++)try{var o=t.getContext(e[i],{premultipliedAlpha:!0});if(o)return o}catch(t){}return null}function live2dStartDraw(t){t.isDrawStart||(t.isDrawStart=!0,function e(){live2dDraw(t),(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(e,this.canvas)}())}function live2dDraw(t){MatrixStack.reset(),MatrixStack.loadIdentity(),t.dragMgr.update(),t.live2DMgr.setDrag(),t.gl.clear(t.gl.COLOR_BUFFER_BIT),MatrixStack.multMatrix(t.projMatrix.getArray()),MatrixStack.multMatrix(t.viewMatrix.getArray()),MatrixStack.push();for(var e=0;e<t.live2DMgr.numModels();e++){var i=t.live2DMgr.getModel(e);if(null==i)return;i.initialized&&!i.updating&&(i.update(),i.draw(t.gl))}MatrixStack.pop()}function MatrixStack(){}function ModelSettingJson(){this.NAME="name",this.ID="id",this.MODEL="model",this.TEXTURES="textures",this.HIT_AREAS="hit_areas",this.PHYSICS="physics",this.POSE="pose",this.EXPRESSIONS="expressions",this.MOTION_GROUPS="motions",this.SOUND="sound",this.FADE_IN="fade_in",this.FADE_OUT="fade_out",this.LAYOUT="layout",this.INIT_PARAM="init_param",this.INIT_PARTS_VISIBLE="init_parts_visible",this.VALUE="val",this.FILE="file",this.json={}}function PlatformManager(t){this.canvas=t}var LAppDefine={DEBUG_LOG:!1,DEBUG_MOUSE_LOG:!1,VIEW_MAX_SCALE:2,VIEW_MIN_SCALE:.8,VIEW_LOGICAL_LEFT:-1,VIEW_LOGICAL_RIGHT:1,VIEW_LOGICAL_MAX_LEFT:-2,VIEW_LOGICAL_MAX_RIGHT:2,VIEW_LOGICAL_MAX_BOTTOM:-2,VIEW_LOGICAL_MAX_TOP:2,PRIORITY_NONE:0,PRIORITY_IDLE:1,PRIORITY_NORMAL:2,PRIORITY_FORCE:3,MOTION_GROUP_IDLE:"idle",MOTION_GROUP_TAP_BODY:"tap_body",MOTION_GROUP_FLICK_HEAD:"flick_head",MOTION_GROUP_PINCH_IN:"pinch_in",MOTION_GROUP_PINCH_OUT:"pinch_out",MOTION_GROUP_SHAKE:"shake",HIT_AREA_HEAD:"head",HIT_AREA_BODY:"body"};LAppLive2DManager.prototype.createModel=function(){var t=new LAppModel;return this.models.push(t),t},LAppLive2DManager.prototype.changeModel=function(t,e,i){this.reloadFlg&&(this.reloadFlg=!1,this.releaseModel(t,0),this.createModel().load(t,e,i))},LAppLive2DManager.prototype.loadModel=function(t,e,i){this.createModel().load(t,e,i)},LAppLive2DManager.prototype.getModel=function(t){return t>=this.models.length?null:this.models[t]},LAppLive2DManager.prototype.releaseModel=function(t,e){this.models.length<=e||(this.models[e].release(t),delete this.models[e],this.models.splice(e,1))},LAppLive2DManager.prototype.numModels=function(){return this.models.length},LAppLive2DManager.prototype.setDrag=function(t,e){for(var i=0;i<this.models.length;i++){var o=this.models[i].dragMgr;null!=o&&this.models[i].setDrag(o.getX(),o.getY())}},LAppLive2DManager.prototype.playSoundAJAX=function(t,e){var i=this,o=e,r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){switch(r.status){case 200:var e=r.response;i.models[o].playSoundAJAX(e);break;default:console.error("Failed to load ("+r.status+") : "+t)}},r.send()},LAppLive2DManager.prototype.playSound=function(t,e){this.models[e].playSound(t)},LAppLive2DManager.prototype.tapEvent=function(t,e){LAppDefine.DEBUG_LOG&&console.log("tapEvent view x:"+t+" y:"+e);for(var i=0;i<this.models.length;i++)this.models[i].hitTest(LAppDefine.HIT_AREA_HEAD,t,e)?(LAppDefine.DEBUG_LOG&&console.log("Tap face."),this.models[i].setRandomExpression()):this.models[i].hitTest(LAppDefine.HIT_AREA_BODY,t,e)&&(LAppDefine.DEBUG_LOG&&console.log("Tap body. models["+i+"]"),this.models[i].startRandomMotion(LAppDefine.MOTION_GROUP_TAP_BODY,LAppDefine.PRIORITY_NORMAL));return!0},LAppModel.prototype=new L2DBaseModel,LAppModel.prototype.setDragMgr=function(t){this.dragMgr=t},LAppModel.prototype.load=function(t,e,i){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=e.substring(0,e.lastIndexOf("/")+1),this.modelSetting=new ModelSettingJson;var o=this;this.modelSetting.loadModelSetting(e,function(){var t=o.modelHomeDir+o.modelSetting.getModelFile();o.loadModelData(t,function(t){for(var e=0;e<o.modelSetting.getTextureNum();e++){var r=o.modelHomeDir+o.modelSetting.getTextureFile(e);o.loadTexture(e,r,function(){if(o.isTexLoaded){if(o.modelSetting.getExpressionNum()>0){o.expressions={};for(var t=0;t<o.modelSetting.getExpressionNum();t++){var e=o.modelSetting.getExpressionName(t),r=o.modelHomeDir+o.modelSetting.getExpressionFile(t);o.loadExpression(e,r)}}else o.expressionManager=null,o.expressions={};if(null==o.eyeBlink&&(o.eyeBlink=new L2DEyeBlink),null!=o.modelSetting.getPhysicsFile()?o.loadPhysics(o.modelHomeDir+o.modelSetting.getPhysicsFile()):o.physics=null,null!=o.modelSetting.getPoseFile()?o.loadPose(o.modelHomeDir+o.modelSetting.getPoseFile(),function(){o.pose.updateParam(o.live2DModel)}):o.pose=null,null!=o.modelSetting.getLayout()){var n=o.modelSetting.getLayout();null!=n.width&&o.modelMatrix.setWidth(n.width),null!=n.height&&o.modelMatrix.setHeight(n.height),null!=n.x&&o.modelMatrix.setX(n.x),null!=n.y&&o.modelMatrix.setY(n.y),null!=n.center_x&&o.modelMatrix.centerX(n.center_x),null!=n.center_y&&o.modelMatrix.centerY(n.center_y),null!=n.top&&o.modelMatrix.top(n.top),null!=n.bottom&&o.modelMatrix.bottom(n.bottom),null!=n.left&&o.modelMatrix.left(n.left),null!=n.right&&o.modelMatrix.right(n.right)}for(var t=0;t<o.modelSetting.getInitParamNum();t++)o.live2DModel.setParamFloat(o.modelSetting.getInitParamID(t),o.modelSetting.getInitParamValue(t));for(var t=0;t<o.modelSetting.getInitPartsVisibleNum();t++)o.live2DModel.setPartsOpacity(o.modelSetting.getInitPartsVisibleID(t),o.modelSetting.getInitPartsVisibleValue(t));o.live2DModel.saveParam(),o.preloadMotionGroup(LAppDefine.MOTION_GROUP_IDLE),o.mainMotionManager.stopAllMotions(),o.setUpdating(!1),o.setInitialized(!0),"function"==typeof i&&i()}})}})})},LAppModel.prototype.release=function(t){var e=Live2DFramework.getPlatformManager();t.deleteTexture(e.texture)},LAppModel.prototype.preloadMotionGroup=function(t){for(var e=this,i=0;i<this.modelSetting.getMotionNum(t);i++){var o=this.modelSetting.getMotionFile(t,i);this.loadMotion(o,this.modelHomeDir+o,function(o){o.setFadeIn(e.modelSetting.getMotionFadeIn(t,i)),o.setFadeOut(e.modelSetting.getMotionFadeOut(t,i))})}},LAppModel.prototype.update=function(){if(null==this.live2DModel)return void(LAppDefine.DEBUG_LOG&&console.error("Failed to update."));var t=UtSystem.getUserTimeMSec()-this.startTimeMSec,e=t/1e3,i=2*e*Math.PI;this.mainMotionManager.isFinished()&&this.startRandomMotion(LAppDefine.MOTION_GROUP_IDLE,LAppDefine.PRIORITY_IDLE),this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(i/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(i/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(i/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(i/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(i/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()},LAppModel.prototype.setRandomExpression=function(){var t=[];for(var e in this.expressions)t.push(e);var i=parseInt(Math.random()*t.length);this.setExpression(t[i])},LAppModel.prototype.startRandomMotion=function(t,e){var i=this.modelSetting.getMotionNum(t),o=parseInt(Math.random()*i);this.startMotion(t,o,e)},LAppModel.prototype.startMotion=function(t,e,i){var o=this.modelSetting.getMotionFile(t,e);if(null==o||""==o)return void(LAppDefine.DEBUG_LOG&&console.error("Failed to motion."));if(i==LAppDefine.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(i);else if(!this.mainMotionManager.reserveMotion(i))return void(LAppDefine.DEBUG_LOG&&console.log("Motion is running."));var r,n=this;null==this.motions[t]?this.loadMotion(null,this.modelHomeDir+o,function(o){r=o,n.setFadeInFadeOut(t,e,i,r)}):(r=this.motions[t],n.setFadeInFadeOut(t,e,i,r))},LAppModel.prototype.setFadeInFadeOut=function(t,e,i,o){var r=this.modelSetting.getMotionFile(t,e);if(o.setFadeIn(this.modelSetting.getMotionFadeIn(t,e)),o.setFadeOut(this.modelSetting.getMotionFadeOut(t,e)),LAppDefine.DEBUG_LOG&&console.log("Start motion : "+r),null==this.modelSetting.getMotionSound(t,e))this.mainMotionManager.startMotionPrio(o,i);else{var n=this.modelSetting.getMotionSound(t,e),s=document.createElement("audio");s.src=this.modelHomeDir+n,LAppDefine.DEBUG_LOG&&console.log("Start sound : "+n),s.play(),this.mainMotionManager.startMotionPrio(o,i)}},LAppModel.prototype.playSoundAJAX=function(t){clearInterval(this.intervalId);var e=this,i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;if(i){var o=this.audioContext||new i;this.audioContext||(this.audioContext=o),null!=this.bufferSource&&(this.bufferSource.stop(),this.bufferSource=null,clearInterval(this.intervalId),this.lipSyncValue=0),o.decodeAudioData(t,function(t){e.bufferSource=o.createBufferSource(),e.bufferSource.buffer=t,e.bufferSource.connect(o.destination),e.bufferSource.loop=!1;var i=e.audioAnalyser||o.createAnalyser();!e.audioAnalyser&&(e.audioAnalyser=i),i.fftSize=32;var r=i.frequencyBinCount,n=[],s=Date.now();e.intervalId=setInterval(function(){var t=new Uint8Array(r);i.getByteFrequencyData(t);var o=(t[9]+t[10]+t[11])/3;if(Date.now()-s<33)n.push(o);else{var a=n.length?n.reduce(function(t,e){return e+=t})/n.length/25:e.lipSyncValue;e.lipSync=!0,e.lipSyncValue=a,s=Date.now(),n=[]}},0),e.bufferSource.onended=function(){clearInterval(e.intervalId),e.lipSyncValue=0},e.bufferSource.connect(i),i.connect(o.destination),e.bufferSource.start(0)})}},LAppModel.prototype.playSound=function(t){var e=this.audioElement||document.createElement("audio");!this.audioElement&&(this.audioElement=e),e.src=t,e.load(),clearInterval(this.intervalId);var i=this,o=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;if(o){var r=this.audioContext||new o;this.audioContext||(this.audioContext=r,this.audioElementSource=r.createMediaElementSource(e));var n=this.audioElementSource,s=i.audioAnalyser||r.createAnalyser();!i.audioAnalyser&&(i.audioAnalyser=s),s.fftSize=32;var a=s.frequencyBinCount,l=[],h=Date.now();i.intervalId=setInterval(function(){var t=new Uint8Array(a);s.getByteFrequencyData(t);var e=(t[9]+t[10]+t[11])/3;if(Date.now()-h<33)l.push(e);else{var o=l.length?l.reduce(function(t,e){return e+=t})/l.length/100:i.lipSyncValue;i.lipSync=!0,i.lipSyncValue=o,h=Date.now(),l=[]}},0),e.addEventListener("ended",function(){clearInterval(i.intervalId),this.lipSyncValue=0}),n.connect(s),s.connect(r.destination),e.play()}},LAppModel.prototype.setExpression=function(t){var e=this.expressions[t];LAppDefine.DEBUG_LOG&&console.log("Expression : "+t),this.expressionManager.startMotion(e,!1)},LAppModel.prototype.draw=function(t){MatrixStack.push(),MatrixStack.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=MatrixStack.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),MatrixStack.pop()},LAppModel.prototype.hitTest=function(t,e,i){for(var o=this.modelSetting.getHitAreaNum(),r=0;r<o;r++)if(t==this.modelSetting.getHitAreaName(r)){var n=this.modelSetting.getHitAreaID(r);return this.hitTestSimple(n,e,i)}return!1};var texCounter=0;L2DBaseModel.prototype.getModelMatrix=function(){return this.modelMatrix},L2DBaseModel.prototype.setAlpha=function(t){t>.999&&(t=1),t<.001&&(t=0),this.alpha=t},L2DBaseModel.prototype.getAlpha=function(){return this.alpha},L2DBaseModel.prototype.isInitialized=function(){return this.initialized},L2DBaseModel.prototype.setInitialized=function(t){this.initialized=t},L2DBaseModel.prototype.isUpdating=function(){return this.updating},L2DBaseModel.prototype.setUpdating=function(t){this.updating=t},L2DBaseModel.prototype.getLive2DModel=function(){return this.live2DModel},L2DBaseModel.prototype.setLipSync=function(t){this.lipSync=t},L2DBaseModel.prototype.setLipSyncValue=function(t){this.lipSyncValue=t},L2DBaseModel.prototype.setAccel=function(t,e,i){this.accelX=t,this.accelY=e,this.accelZ=i},L2DBaseModel.prototype.setDrag=function(t,e){this.dragX=t,this.dragY=e},L2DBaseModel.prototype.getMainMotionManager=function(){return this.mainMotionManager},L2DBaseModel.prototype.getExpressionManager=function(){return this.expressionManager},L2DBaseModel.prototype.loadModelData=function(t,e){var i=Live2DFramework.getPlatformManager();this.debugMode&&i.log("Load model : "+t);var o=this;i.loadLive2DModel(t,function(t){if(o.live2DModel=t,o.live2DModel.saveParam(),0!=Live2D.getError())return void console.error("Error : Failed to loadModelData().");o.modelMatrix=new L2DModelMatrix(o.live2DModel.getCanvasWidth(),o.live2DModel.getCanvasHeight()),o.modelMatrix.setWidth(2),o.modelMatrix.setCenterPosition(0,0),e(o.live2DModel)})},L2DBaseModel.prototype.loadTexture=function(t,e,i){texCounter++;var o=Live2DFramework.getPlatformManager();this.debugMode&&o.log("Load Texture : "+e);var r=this;o.loadTexture(this.live2DModel,t,e,function(){texCounter--,0==texCounter&&(r.isTexLoaded=!0),"function"==typeof i&&i()})},L2DBaseModel.prototype.loadMotion=function(t,e,i){var o=Live2DFramework.getPlatformManager();this.debugMode&&o.log("Load Motion : "+e);var r=null,n=this;o.loadBytes(e,function(e){r=Live2DMotion.loadMotion(e),null!=t&&(n.motions[t]=r),i(r)})},L2DBaseModel.prototype.loadExpression=function(t,e,i){var o=Live2DFramework.getPlatformManager();this.debugMode&&o.log("Load Expression : "+e);var r=this;o.loadBytes(e,function(e){null!=t&&(r.expressions[t]=L2DExpressionMotion.loadJson(e)),"function"==typeof i&&i()})},L2DBaseModel.prototype.loadPose=function(t,e){var i=Live2DFramework.getPlatformManager();this.debugMode&&i.log("Load Pose : "+t);var o=this;try{i.loadBytes(t,function(t){o.pose=L2DPose.load(t),"function"==typeof e&&e()})}catch(t){console.warn(t)}},L2DBaseModel.prototype.loadPhysics=function(t){var e=Live2DFramework.getPlatformManager();this.debugMode&&e.log("Load Physics : "+t);var i=this;try{e.loadBytes(t,function(t){i.physics=L2DPhysics.load(t)})}catch(t){console.warn(t)}},L2DBaseModel.prototype.hitTestSimple=function(t,e,i){var o=this.live2DModel.getDrawDataIndex(t);if(o<0)return!1;for(var r=this.live2DModel.getTransformedPoints(o),n=this.live2DModel.getCanvasWidth(),s=0,a=this.live2DModel.getCanvasHeight(),l=0,h=0;h<r.length;h+=2){var p=r[h],u=r[h+1];p<n&&(n=p),p>s&&(s=p),u<a&&(a=u),u>l&&(l=u)}var d=this.modelMatrix.invertTransformX(e),c=this.modelMatrix.invertTransformY(i);return n<=d&&d<=s&&a<=c&&c<=l},L2DExpressionMotion.prototype=new AMotion,L2DExpressionMotion.EXPRESSION_DEFAULT="DEFAULT",L2DExpressionMotion.TYPE_SET=0,L2DExpressionMotion.TYPE_ADD=1,L2DExpressionMotion.TYPE_MULT=2,L2DExpressionMotion.loadJson=function(t){var e=new L2DExpressionMotion,i=Live2DFramework.getPlatformManager(),o=i.jsonParseFromBytes(t);if(e.setFadeIn(parseInt(o.fade_in)>0?parseInt(o.fade_in):1e3),e.setFadeOut(parseInt(o.fade_out)>0?parseInt(o.fade_out):1e3),null==o.params)return e;var r=o.params,n=r.length;e.paramList=[];for(var s=0;s<n;s++){var a=r[s],l=a.id.toString(),h=parseFloat(a.val),p=L2DExpressionMotion.TYPE_ADD,u=null!=a.calc?a.calc.toString():"add";if((p="add"===u?L2DExpressionMotion.TYPE_ADD:"mult"===u?L2DExpressionMotion.TYPE_MULT:"set"===u?L2DExpressionMotion.TYPE_SET:L2DExpressionMotion.TYPE_ADD)==L2DExpressionMotion.TYPE_ADD){var d=null==a.def?0:parseFloat(a.def);h-=d}else if(p==L2DExpressionMotion.TYPE_MULT){var d=null==a.def?1:parseFloat(a.def);0==d&&(d=1),h/=d}var c=new L2DExpressionParam;c.id=l,c.type=p,c.value=h,e.paramList.push(c)}return e},L2DExpressionMotion.prototype.updateParamExe=function(t,e,i,o){for(var r=this.paramList.length-1;r>=0;--r){var n=this.paramList[r];n.type==L2DExpressionMotion.TYPE_ADD?t.addToParamFloat(n.id,n.value,i):n.type==L2DExpressionMotion.TYPE_MULT?t.multParamFloat(n.id,n.value,i):n.type==L2DExpressionMotion.TYPE_SET&&t.setParamFloat(n.id,n.value,i)}},L2DEyeBlink.prototype.calcNextBlink=function(){return UtSystem.getUserTimeMSec()+Math.random()*(2*this.blinkIntervalMsec-1)},L2DEyeBlink.prototype.setInterval=function(t){this.blinkIntervalMsec=t},L2DEyeBlink.prototype.setEyeMotion=function(t,e,i){this.closingMotionMsec=t,this.closedMotionMsec=e,this.openingMotionMsec=i},L2DEyeBlink.prototype.updateParam=function(t){var e,i=UtSystem.getUserTimeMSec(),o=0;switch(this.eyeState){case EYE_STATE.STATE_CLOSING:o=(i-this.stateStartTime)/this.closingMotionMsec,o>=1&&(o=1,this.eyeState=EYE_STATE.STATE_CLOSED,this.stateStartTime=i),e=1-o;break;case EYE_STATE.STATE_CLOSED:o=(i-this.stateStartTime)/this.closedMotionMsec,o>=1&&(this.eyeState=EYE_STATE.STATE_OPENING,this.stateStartTime=i),e=0;break;case EYE_STATE.STATE_OPENING:o=(i-this.stateStartTime)/this.openingMotionMsec,o>=1&&(o=1,this.eyeState=EYE_STATE.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink()),e=o;break;case EYE_STATE.STATE_INTERVAL:this.nextBlinkTime<i&&(this.eyeState=EYE_STATE.STATE_CLOSING,this.stateStartTime=i),e=1;break;case EYE_STATE.STATE_FIRST:default:this.eyeState=EYE_STATE.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink(),e=1}this.closeIfZero||(e=-e),t.setParamFloat(this.eyeID_L,e),t.setParamFloat(this.eyeID_R,e)};var EYE_STATE=function(){};EYE_STATE.STATE_FIRST="STATE_FIRST",EYE_STATE.STATE_INTERVAL="STATE_INTERVAL",EYE_STATE.STATE_CLOSING="STATE_CLOSING",EYE_STATE.STATE_CLOSED="STATE_CLOSED",EYE_STATE.STATE_OPENING="STATE_OPENING",L2DMatrix44.mul=function(t,e,i){var o,r,n,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<4;o++)for(r=0;r<4;r++)for(n=0;n<4;n++)s[o+4*r]+=t[o+4*n]*e[n+4*r];for(o=0;o<16;o++)i[o]=s[o]},L2DMatrix44.prototype.identity=function(){for(var t=0;t<16;t++)this.tr[t]=t%5==0?1:0},L2DMatrix44.prototype.getArray=function(){return this.tr},L2DMatrix44.prototype.getCopyMatrix=function(){return new Float32Array(this.tr)},L2DMatrix44.prototype.setMatrix=function(t){if(null!=this.tr&&this.tr.length==this.tr.length)for(var e=0;e<16;e++)this.tr[e]=t[e]},L2DMatrix44.prototype.getScaleX=function(){return this.tr[0]},L2DMatrix44.prototype.getScaleY=function(){return this.tr[5]},L2DMatrix44.prototype.transformX=function(t){return this.tr[0]*t+this.tr[12]},L2DMatrix44.prototype.transformY=function(t){return this.tr[5]*t+this.tr[13]},L2DMatrix44.prototype.invertTransformX=function(t){return(t-this.tr[12])/this.tr[0]},L2DMatrix44.prototype.invertTransformY=function(t){return(t-this.tr[13])/this.tr[5]},L2DMatrix44.prototype.multTranslate=function(t,e){var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];L2DMatrix44.mul(i,this.tr,this.tr)},L2DMatrix44.prototype.translate=function(t,e){this.tr[12]=t,this.tr[13]=e},L2DMatrix44.prototype.translateX=function(t){this.tr[12]=t},L2DMatrix44.prototype.translateY=function(t){this.tr[13]=t},L2DMatrix44.prototype.multScale=function(t,e){var i=[t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1];L2DMatrix44.mul(i,this.tr,this.tr)},L2DMatrix44.prototype.scale=function(t,e){this.tr[0]=t,this.tr[5]=e},L2DModelMatrix.prototype=new L2DMatrix44,L2DModelMatrix.prototype.setPosition=function(t,e){this.translate(t,e)},L2DModelMatrix.prototype.setCenterPosition=function(t,e){var i=this.width*this.getScaleX(),o=this.height*this.getScaleY();this.translate(t-i/2,e-o/2)},L2DModelMatrix.prototype.top=function(t){this.setY(t)},L2DModelMatrix.prototype.bottom=function(t){var e=this.height*this.getScaleY();this.translateY(t-e)},L2DModelMatrix.prototype.left=function(t){this.setX(t)},L2DModelMatrix.prototype.right=function(t){var e=this.width*this.getScaleX();this.translateX(t-e)},L2DModelMatrix.prototype.centerX=function(t){var e=this.width*this.getScaleX();this.translateX(t-e/2)},L2DModelMatrix.prototype.centerY=function(t){var e=this.height*this.getScaleY();this.translateY(t-e/2)},L2DModelMatrix.prototype.setX=function(t){this.translateX(t)},L2DModelMatrix.prototype.setY=function(t){this.translateY(t)},L2DModelMatrix.prototype.setHeight=function(t){var e=t/this.height,i=-e;this.scale(e,i)},L2DModelMatrix.prototype.setWidth=function(t){var e=t/this.width,i=-e;this.scale(e,i)},L2DMotionManager.prototype=new MotionQueueManager,L2DMotionManager.prototype.getCurrentPriority=function(){return this.currentPriority},L2DMotionManager.prototype.getReservePriority=function(){return this.reservePriority},L2DMotionManager.prototype.reserveMotion=function(t){return!(this.reservePriority>=t)&&(!(this.currentPriority>=t)&&(this.reservePriority=t,!0))},L2DMotionManager.prototype.setReservePriority=function(t){this.reservePriority=t},L2DMotionManager.prototype.updateParam=function(t){var e=MotionQueueManager.prototype.updateParam.call(this,t);return this.isFinished()&&(this.currentPriority=0),e},L2DMotionManager.prototype.startMotionPrio=function(t,e){return e==this.reservePriority&&(this.reservePriority=0),this.currentPriority=e,this.startMotion(t,!1)},L2DPhysics.load=function(t){for(var e=new L2DPhysics,i=Live2DFramework.getPlatformManager(),o=i.jsonParseFromBytes(t),r=o.physics_hair,n=r.length,s=0;s<n;s++){var a=r[s],l=new PhysicsHair,h=a.setup,p=parseFloat(h.length),u=parseFloat(h.regist),d=parseFloat(h.mass);l.setup(p,u,d);for(var c=a.src,M=c.length,g=0;g<M;g++){var f=c[g],m=f.id,L=PhysicsHair.Src.SRC_TO_X,D=f.ptype;"x"===D?L=PhysicsHair.Src.SRC_TO_X:"y"===D?L=PhysicsHair.Src.SRC_TO_Y:"angle"===D?L=PhysicsHair.Src.SRC_TO_G_ANGLE:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Src");var S=parseFloat(f.scale),v=parseFloat(f.weight);l.addSrcParam(L,m,S,v)}for(var y=a.targets,T=y.length,g=0;g<T;g++){var E=y[g],m=E.id,L=PhysicsHair.Target.TARGET_FROM_ANGLE,D=E.ptype;"angle"===D?L=PhysicsHair.Target.TARGET_FROM_ANGLE:"angle_v"===D?L=PhysicsHair.Target.TARGET_FROM_ANGLE_V:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Target");var S=parseFloat(E.scale),v=parseFloat(E.weight);l.addTargetParam(L,m,S,v)}e.physicsList.push(l)}return e},L2DPhysics.prototype.updateParam=function(t){for(var e=UtSystem.getUserTimeMSec()-this.startTimeMSec,i=0;i<this.physicsList.length;i++)this.physicsList[i].update(t,e)},L2DPose.load=function(t){for(var e=new L2DPose,i=Live2DFramework.getPlatformManager(),o=i.jsonParseFromBytes(t),r=o.parts_visible,n=r.length,s=0;s<n;s++){for(var a=r[s],l=a.group,h=l.length,p=new Array,u=0;u<h;u++){var d=l[u],c=new L2DPartsParam(d.id);if(p[u]=c,null!=d.link){var M=d.link,g=M.length;c.link=new Array;for(var f=0;f<g;f++){var m=new L2DPartsParam(M[f]);c.link.push(m)}}}e.partsGroups.push(p)}return e},L2DPose.prototype.updateParam=function(t){if(null!=t){t!=this.lastModel&&this.initParam(t),this.lastModel=t;var e=UtSystem.getUserTimeMSec(),i=0==this.lastTime?0:(e-this.lastTime)/1e3;this.lastTime=e,i<0&&(i=0);for(var o=0;o<this.partsGroups.length;o++)this.normalizePartsOpacityGroup(t,this.partsGroups[o],i),this.copyOpacityOtherParts(t,this.partsGroups[o])}},L2DPose.prototype.initParam=function(t){if(null!=t)for(var e=0;e<this.partsGroups.length;e++)for(var i=this.partsGroups[e],o=0;o<i.length;o++){i[o].initIndex(t);var r=i[o].partsIndex,n=i[o].paramIndex;if(!(r<0)){var s=0!=t.getParamFloat(n);if(t.setPartsOpacity(r,s?1:0),t.setParamFloat(n,s?1:0),null!=i[o].link)for(var a=0;a<i[o].link.length;a++)i[o].link[a].initIndex(t)}}},L2DPose.prototype.normalizePartsOpacityGroup=function(t,e,i){for(var o=-1,r=1,n=0;n<e.length;n++){var s=e[n].partsIndex,a=e[n].paramIndex;if(!(s<0)&&0!=t.getParamFloat(a)){if(o>=0)break;o=n,r=t.getPartsOpacity(s),r+=i/.5,r>1&&(r=1)}}o<0&&(o=0,r=1);for(var n=0;n<e.length;n++){var s=e[n].partsIndex;if(!(s<0))if(o==n)t.setPartsOpacity(s,r);else{var l,h=t.getPartsOpacity(s);l=r<.5?r*-.5/.5+1:.5*(1-r)/.5;var p=(1-l)*(1-r);p>.15&&(l=1-.15/(1-r)),h>l&&(h=l),t.setPartsOpacity(s,h)}}},L2DPose.prototype.copyOpacityOtherParts=function(t,e){for(var i=0;i<e.length;i++){var o=e[i];if(null!=o.link&&!(o.partsIndex<0))for(var r=t.getPartsOpacity(o.partsIndex),n=0;n<o.link.length;n++){var s=o.link[n];s.partsIndex<0||t.setPartsOpacity(s.partsIndex,r)}}},L2DPartsParam.prototype.initIndex=function(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)},L2DTargetPoint.FRAME_RATE=30,L2DTargetPoint.prototype.setPoint=function(t,e){this.faceTargetX=t,this.faceTargetY=e},L2DTargetPoint.prototype.getX=function(){return this.faceX},L2DTargetPoint.prototype.getY=function(){return this.faceY},L2DTargetPoint.prototype.update=function(){var t=40/7.5/L2DTargetPoint.FRAME_RATE;if(0==this.lastTimeSec)return void(this.lastTimeSec=UtSystem.getUserTimeMSec());var e=UtSystem.getUserTimeMSec(),i=(e-this.lastTimeSec)*L2DTargetPoint.FRAME_RATE/1e3;this.lastTimeSec=e;var o=.15*L2DTargetPoint.FRAME_RATE,r=i*t/o,n=this.faceTargetX-this.faceX,s=this.faceTargetY-this.faceY;if(!(Math.abs(n)<=this.EPSILON&&Math.abs(s)<=this.EPSILON)){var a=Math.sqrt(n*n+s*s),l=t*n/a,h=t*s/a,p=l-this.faceVX,u=h-this.faceVY,d=Math.sqrt(p*p+u*u);(d<-r||d>r)&&(p*=r/d,u*=r/d,d=r),this.faceVX+=p,this.faceVY+=u;var c=.5*(Math.sqrt(r*r+16*r*a-8*r*a)-r),M=Math.sqrt(this.faceVX*this.faceVX+this.faceVY*this.faceVY);M>c&&(this.faceVX*=c/M,this.faceVY*=c/M),this.faceX+=this.faceVX,this.faceY+=this.faceVY}},L2DViewMatrix.prototype=new L2DMatrix44,L2DViewMatrix.prototype.getMaxScale=function(){return this.max},L2DViewMatrix.prototype.getMinScale=function(){return this.min},L2DViewMatrix.prototype.setMaxScale=function(t){this.max=t},L2DViewMatrix.prototype.setMinScale=function(t){this.min=t},L2DViewMatrix.prototype.isMaxScale=function(){return this.getScaleX()==this.max},L2DViewMatrix.prototype.isMinScale=function(){return this.getScaleX()==this.min},L2DViewMatrix.prototype.adjustTranslate=function(t,e){this.tr[0]*this.maxLeft+(this.tr[12]+t)>this.screenLeft&&(t=this.screenLeft-this.tr[0]*this.maxLeft-this.tr[12]),this.tr[0]*this.maxRight+(this.tr[12]+t)<this.screenRight&&(t=this.screenRight-this.tr[0]*this.maxRight-this.tr[12]),this.tr[5]*this.maxTop+(this.tr[13]+e)<this.screenTop&&(e=this.screenTop-this.tr[5]*this.maxTop-this.tr[13]),this.tr[5]*this.maxBottom+(this.tr[13]+e)>this.screenBottom&&(e=this.screenBottom-this.tr[5]*this.maxBottom-this.tr[13]);var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];L2DMatrix44.mul(i,this.tr,this.tr)},L2DViewMatrix.prototype.adjustScale=function(t,e,i){var o=i*this.tr[0];o<this.min?this.tr[0]>0&&(i=this.min/this.tr[0]):o>this.max&&this.tr[0]>0&&(i=this.max/this.tr[0]);var r=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1],n=[i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1];L2DMatrix44.mul(s,this.tr,this.tr),L2DMatrix44.mul(n,this.tr,this.tr),L2DMatrix44.mul(r,this.tr,this.tr)},L2DViewMatrix.prototype.setScreenRect=function(t,e,i,o){this.screenLeft=t,this.screenRight=e,this.screenTop=o,this.screenBottom=i},L2DViewMatrix.prototype.setMaxScreenRect=function(t,e,i,o){this.maxLeft=t,this.maxRight=e,this.maxTop=o,this.maxBottom=i},L2DViewMatrix.prototype.getScreenLeft=function(){return this.screenLeft},L2DViewMatrix.prototype.getScreenRight=function(){return this.screenRight},L2DViewMatrix.prototype.getScreenBottom=function(){return this.screenBottom},L2DViewMatrix.prototype.getScreenTop=function(){return this.screenTop},L2DViewMatrix.prototype.getMaxLeft=function(){return this.maxLeft},L2DViewMatrix.prototype.getMaxRight=function(){return this.maxRight},L2DViewMatrix.prototype.getMaxBottom=function(){return this.maxBottom},L2DViewMatrix.prototype.getMaxTop=function(){return this.maxTop},Live2DFramework.platformManager=null,Live2DFramework.getPlatformManager=function(){return Live2DFramework.platformManager},Live2DFramework.setPlatformManager=function(t){Live2DFramework.platformManager=t};var thisRef=this;Live2DHelper.prototype.init=function(){var t=this.canvas.width,e=this.canvas.height;this.dragMgr=new L2DTargetPoint;var i=e/t,o=LAppDefine.VIEW_LOGICAL_LEFT,r=LAppDefine.VIEW_LOGICAL_RIGHT,n=-i,s=i;if(this.viewMatrix=new L2DViewMatrix,this.viewMatrix.setScreenRect(o,r,n,s),this.viewMatrix.setMaxScreenRect(LAppDefine.VIEW_LOGICAL_MAX_LEFT,LAppDefine.VIEW_LOGICAL_MAX_RIGHT,LAppDefine.VIEW_LOGICAL_MAX_BOTTOM,LAppDefine.VIEW_LOGICAL_MAX_TOP),this.viewMatrix.setMaxScale(LAppDefine.VIEW_MAX_SCALE),this.viewMatrix.setMinScale(LAppDefine.VIEW_MIN_SCALE),this.projMatrix=new L2DMatrix44,this.projMatrix.multScale(1,t/e),this.deviceToScreen=new L2DMatrix44,this.deviceToScreen.multTranslate(-t/2,-e/2),
this.deviceToScreen.multScale(2/t,-2/t),this.gl=getWebGLContext(this.canvas),!this.gl)return void console.log("Failed to create WebGL context.");Live2D.setGL(this.gl),this.gl.clearColor(0,0,0,0),live2dStartDraw(this)},Live2DHelper.prototype.mouseEvent=function(t){if(t.preventDefault(),"mousewheel"==t.type){if(t.clientX<0||this.canvas.clientWidth<t.clientX||t.clientY<0||this.canvas.clientHeight<t.clientY)return;t.wheelDelta>0?this.modelScaling(1.1):this.modelScaling(.9)}else if("mousedown"==t.type){if("button"in t&&0!=t.button)return;this.modelTurnHead(t)}else if("mousemove"==t.type)followPointer(t);else if("mouseup"==t.type){if("button"in t&&0!=t.button)return;this.lookFront()}else"mouseout"==t.type?lookFront():"contextmenu"==t.type&&this.changeModel()},Live2DHelper.prototype.touchEvent=function(t){t.preventDefault();var e=t.touches[0];if("touchstart"==t.type)1==t.touches.length&&modelTurnHead(e);else if("touchmove"==t.type){if(followPointer(e),2==t.touches.length){var i=t.touches[0],o=t.touches[1],r=Math.pow(i.pageX-o.pageX,2)+Math.pow(i.pageY-o.pageY,2);thisRef.oldLen-r<0?this.modelScaling(1.025):this.modelScaling(.975),thisRef.oldLen=r}}else"touchend"==t.type&&lookFront()},Live2DHelper.prototype.modelScaling=function(t){var e=this.viewMatrix.isMaxScale(),i=this.viewMatrix.isMinScale();this.viewMatrix.adjustScale(0,0,t),e||this.viewMatrix.isMaxScale()&&this.live2DMgr.maxScaleEvent(),i||this.viewMatrix.isMinScale()&&this.live2DMgr.minScaleEvent()},Live2DHelper.prototype.startTurnHead=function(t){null==t&&(t=0),this.live2DMgr.models[t].setDragMgr(this.dragMgr)},Live2DHelper.prototype.stopTurnHead=function(t){null==t&&(t=0),this.modelsViewPointer(0,0),this.live2DMgr.models[t].setDragMgr(null)},Live2DHelper.prototype.followPointer=function(t){var e=t.target.getBoundingClientRect(),i=this.transformScreenX(t.clientX-e.left),o=this.transformScreenY(t.clientY-e.top),r=this.transformViewX(t.clientX-e.left),n=this.transformViewY(t.clientY-e.top);this.lastMouseX=i,this.lastMouseY=o,this.viewPointer(r,n)},Live2DHelper.prototype.viewPointer=function(t,e){this.dragMgr.setPoint(t,e)},Live2DHelper.prototype.transformViewX=function(t){var e=this.deviceToScreen.transformX(t);return this.viewMatrix.invertTransformX(e)},Live2DHelper.prototype.transformViewY=function(t){var e=this.deviceToScreen.transformY(t);return this.viewMatrix.invertTransformY(e)},Live2DHelper.prototype.transformScreenX=function(t){return this.deviceToScreen.transformX(t)},Live2DHelper.prototype.transformScreenY=function(t){return this.deviceToScreen.transformY(t)},Live2DHelper.prototype.loadModel=function(t,e){this.live2DMgr.loadModel(this.gl,t,e)},Live2DHelper.prototype.releaseModel=function(t){null==t&&(t=0),this.live2DMgr.releaseModel(this.gl,t)},Live2DHelper.prototype.releaseAllModel=function(){for(var t=this.live2DMgr.models.length,e=t;e>0;e--)this.live2DMgr.releaseModel(this.gl,e)},Live2DHelper.prototype.changeModel=function(t,e){this.live2DMgr.reloadFlg=!0,this.live2DMgr.changeModel(this.gl,t,e)},Live2DHelper.prototype.setRandomExpression=function(t){null==t&&(t=0),this.live2DMgr.models[t].setRandomExpression()},Live2DHelper.prototype.getExpressions=function(t){return null==t&&(t=0),this.live2DMgr.models[t].expressions},Live2DHelper.prototype.setExpression=function(t,e){null==e&&(e=0),this.live2DMgr.models[e].setExpression(t)},Live2DHelper.prototype.startRandomMotion=function(t){null==t&&(t=0)},Live2DHelper.prototype.startMotion=function(t,e,i){null==i&&(i=0),this.live2DMgr.models[i].startMotion(t,e,LAppDefine.PRIORITY_FORCE)},Live2DHelper.prototype.playSoundAJAX=function(t,e){null==e&&(e=0),this.live2DMgr.playSoundAJAX(t,e)},Live2DHelper.prototype.playSound=function(t,e){null==e&&(e=0),this.live2DMgr.playSound(t,e)},Live2DHelper.prototype.getModel=function(t){return this.pModel=t,this},Live2DHelper.prototype.startPointer=function(){return this.modelStartPointer(this.pModel),this},Live2DHelper.prototype.change=function(t){this.modelStartPointer(this.pModel)},MatrixStack.matrixStack=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MatrixStack.depth=0,MatrixStack.currentMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MatrixStack.tmp=new Array(16),MatrixStack.reset=function(){this.depth=0},MatrixStack.loadIdentity=function(){for(var t=0;t<16;t++)this.currentMatrix[t]=t%5==0?1:0},MatrixStack.push=function(){var t=(this.depth,16*(this.depth+1));this.matrixStack.length<t+16&&(this.matrixStack.length=t+16);for(var e=0;e<16;e++)this.matrixStack[t+e]=this.currentMatrix[e];this.depth++},MatrixStack.pop=function(){--this.depth<0&&(myError("Invalid matrix stack."),this.depth=0);for(var t=16*this.depth,e=0;e<16;e++)this.currentMatrix[e]=this.matrixStack[t+e]},MatrixStack.getMatrix=function(){return this.currentMatrix},MatrixStack.multMatrix=function(t){var e,i,o;for(e=0;e<16;e++)this.tmp[e]=0;for(e=0;e<4;e++)for(i=0;i<4;i++)for(o=0;o<4;o++)this.tmp[e+4*i]+=this.currentMatrix[e+4*o]*t[o+4*i];for(e=0;e<16;e++)this.currentMatrix[e]=this.tmp[e]},ModelSettingJson.prototype.loadModelSetting=function(t,e){var i=this;Live2DFramework.getPlatformManager().loadBytes(t,function(t){var o=String.fromCharCode.apply(null,new Uint8Array(t));i.json=JSON.parse(o),e()})},ModelSettingJson.prototype.getTextureFile=function(t){return null==this.json[this.TEXTURES]||null==this.json[this.TEXTURES][t]?null:this.json[this.TEXTURES][t]},ModelSettingJson.prototype.getModelFile=function(){return this.json[this.MODEL]},ModelSettingJson.prototype.getTextureNum=function(){return null==this.json[this.TEXTURES]?0:this.json[this.TEXTURES].length},ModelSettingJson.prototype.getHitAreaNum=function(){return null==this.json[this.HIT_AREAS]?0:this.json[this.HIT_AREAS].length},ModelSettingJson.prototype.getHitAreaID=function(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.ID]},ModelSettingJson.prototype.getHitAreaName=function(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.NAME]},ModelSettingJson.prototype.getPhysicsFile=function(){return this.json[this.PHYSICS]},ModelSettingJson.prototype.getPoseFile=function(){return this.json[this.POSE]},ModelSettingJson.prototype.getExpressionNum=function(){return null==this.json[this.EXPRESSIONS]?0:this.json[this.EXPRESSIONS].length},ModelSettingJson.prototype.getExpressionFile=function(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.FILE]},ModelSettingJson.prototype.getExpressionName=function(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.NAME]},ModelSettingJson.prototype.getLayout=function(){return this.json[this.LAYOUT]},ModelSettingJson.prototype.getInitParamNum=function(){return null==this.json[this.INIT_PARAM]?0:this.json[this.INIT_PARAM].length},ModelSettingJson.prototype.getMotionNum=function(t){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]?0:this.json[this.MOTION_GROUPS][t].length},ModelSettingJson.prototype.getMotionFile=function(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]?null:this.json[this.MOTION_GROUPS][t][e][this.FILE]},ModelSettingJson.prototype.getMotionSound=function(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.SOUND]?null:this.json[this.MOTION_GROUPS][t][e][this.SOUND]},ModelSettingJson.prototype.getMotionFadeIn=function(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]},ModelSettingJson.prototype.getMotionFadeOut=function(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]},ModelSettingJson.prototype.getInitParamID=function(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?null:this.json[this.INIT_PARAM][t][this.ID]},ModelSettingJson.prototype.getInitParamValue=function(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?NaN:this.json[this.INIT_PARAM][t][this.VALUE]},ModelSettingJson.prototype.getInitPartsVisibleNum=function(){return null==this.json[this.INIT_PARTS_VISIBLE]?0:this.json[this.INIT_PARTS_VISIBLE].length},ModelSettingJson.prototype.getInitPartsVisibleID=function(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?null:this.json[this.INIT_PARTS_VISIBLE][t][this.ID]},ModelSettingJson.prototype.getInitPartsVisibleValue=function(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?NaN:this.json[this.INIT_PARTS_VISIBLE][t][this.VALUE]},PlatformManager.prototype.loadBytes=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){switch(i.status){case 200:e(i.response);break;default:console.error("Failed to load ("+i.status+") : "+t)}},i.send(null)},PlatformManager.prototype.loadString=function(t){this.loadBytes(t,function(t){return t})},PlatformManager.prototype.loadLive2DModel=function(t,e){var i=null;this.loadBytes(t,function(t){i=Live2DModelWebGL.loadModel(t),e(i)})},PlatformManager.prototype.loadTexture=function(t,e,i,o){var r=new Image;r.src=i;var n=this;r.onload=function(){var i=getWebGLContext(n.canvas,{premultipliedAlpha:!0}),s=i.createTexture();if(!s)return console.error("Failed to generate gl texture name."),-1;0==t.isPremultipliedAlpha()&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D),t.setTexture(e,s),s=null,"function"==typeof o&&o()},r.onerror=function(){console.error("Failed to load image : "+i)}},PlatformManager.prototype.jsonParseFromBytes=function(t){var e,i=new Uint8Array(t,0,3);return e=239==i[0]&&187==i[1]&&191==i[2]?String.fromCharCode.apply(null,new Uint8Array(t,3)):String.fromCharCode.apply(null,new Uint8Array(t)),JSON.parse(e)},PlatformManager.prototype.log=function(t){console.log(t)};